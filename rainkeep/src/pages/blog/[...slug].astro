import { getCollection, getEntryBySlug } from 'astro:content';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');

  return allPosts
    .filter((post) => !!post.slug) // Make sure slug isn't null
    .map((post) => ({
      params: { slug: [post.slug] },
      props: { post }
    }));
}

export async function get({ params }) {
  const slug = params.slug?.[0];
  const post = await getEntryBySlug('blog', slug);

  if (!post) {
    return {
      status: 404,
      body: 'Post not found'
    };
  }

  return {
    props: {
      post
    }
  };
}
